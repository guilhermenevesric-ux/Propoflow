<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>PropoFlow • Novo Orçamento</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>PropoFlow</h1>
          <p>Novo orçamento (itens + etapas)</p>
        </div>
      </div>

      <div class="actions">
        <a class="btn btn-ghost" href="/dashboard">← Voltar</a>
      </div>
    </div>

    <div class="card">
      <h2 class="h2">Criar orçamento</h2>
      <p class="small">Agora você pode colocar itens e o sistema calcula total + sinal/etapas.</p>

      {% if error %}
        <div class="error">{{ error }}</div>
      {% endif %}

      <form method="post" action="/proposals/new">
        <div class="row">
          <div>
            <label>Nome do cliente</label>
            <input name="client_name" required placeholder="Ex: João Silva">
          </div>
          <div>
            <label>WhatsApp do cliente</label>
            <input name="client_whatsapp" placeholder="Ex: (11) 99999-9999">
          </div>
        </div>

        <br>

        <div class="row">
          <div>
            <label>Nome do projeto</label>
            <input name="project_name" required placeholder="Ex: Troca de tomada / Reforma do banheiro">
          </div>
          <div>
            <label>Validade (dias)</label>
            <input name="validity_days" type="number" min="1" max="30" value="7" required>
          </div>
        </div>

        <br>

        <label>Descrição / Observações</label>
        <textarea name="description" required placeholder="O que será feito, o que não está incluso, condições, etc."></textarea>

        <br><br>

        <div class="row">
          <div>
            <label>Prazo</label>
            <input name="deadline" required placeholder="Ex: 7 dias úteis">
          </div>
          <div>
            <label>Imprevistos (%)</label>
            <input name="overhead_percent" type="number" min="0" max="50" value="10">
          </div>
        </div>

        <br>

        <div class="row">
          <div>
            <label>Margem (%)</label>
            <input name="margin_percent" type="number" min="0" max="80" value="0">
          </div>
          <div>
            <label>Preço final (opcional — se preencher, substitui o cálculo)</label>
            <input name="price" placeholder="Ex: R$ 250,00">
          </div>
        </div>

        <br><br>

        <h3 class="h2" style="font-size:15px;">Itens</h3>
        <p class="small" style="margin-top:0;">Se não quiser usar itens, pode deixar vazio e preencher só o preço final.</p>

        <div class="table-wrap">
          <table class="table" id="itemsTable">
            <tr>
              <th>Descrição</th>
              <th>Qtd</th>
              <th>Un</th>
              <th>Valor unit (R$)</th>
            </tr>
            {% for i in range(0,5) %}
            <tr>
              <td><input name="item_desc" placeholder="Ex: Troca de tomada" /></td>
              <td><input name="item_qty" placeholder="1" /></td>
              <td><input name="item_unit" placeholder="un" /></td>
              <td><input name="item_unit_price" placeholder="25" /></td>
            </tr>
            {% endfor %}
          </table>
        </div>

        <div style="margin-top:10px;">
          <button class="btn btn-ghost" type="button" onclick="addRow()">+ Adicionar item</button>
        </div>

        <br><br>

        <h3 class="h2" style="font-size:15px;">Etapas de pagamento</h3>
        <p class="small" style="margin-top:0;">Padrão recomendado: 30/40/30.</p>

        <div class="row">
          <div>
            <label>Sinal (%)</label>
            <input name="p1_percent" type="number" min="0" max="100" value="30">
          </div>
          <div>
            <label>Etapa 1 (%)</label>
            <input name="p2_percent" type="number" min="0" max="100" value="40">
          </div>
        </div>

        <br>

        <div class="row">
          <div>
            <label>Etapa 2 (%)</label>
            <input name="p3_percent" type="number" min="0" max="100" value="30">
          </div>
          <div></div>
        </div>

        <br><br>

        <button class="btn" type="submit">Criar orçamento</button>
      </form>
    </div>
  </div>

  <script>
    function addRow(){
      const table = document.getElementById("itemsTable");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input name="item_desc" placeholder="Ex: Serviço..." /></td>
        <td><input name="item_qty" placeholder="1" /></td>
        <td><input name="item_unit" placeholder="un" /></td>
        <td><input name="item_unit_price" placeholder="100" /></td>
      `;
      table.appendChild(tr);
    }
  </script>
</body>
</html>